<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<meta content="index,follow" name="googlebot">
	<meta content="follow, all" name="Googlebot-Image">
	<meta content="follow, all" name="Scooter">
	<meta content="follow, all" name="msnbot">
	<meta content="follow, all" name="alexabot">
	<meta content="follow, all" name="Slurp">
	<meta content="follow, all" name="ZyBorg">
	<meta content="follow, all" name="Scooter">
	<meta content="true" name="MSSmartTagsPreventParsing">
	<meta content="ALL" name="SPIDERS">
	<meta content="ALL" name="WEBCRAWLERS">
	<meta
		content="aeiwi, alexa, alltheWeb, altavista, aol netfind, anzwers, canada, directhit, euroseek, excite, overture, go, google, hotbot. infomak, kanoodle, lycos, mastersite, national directory, northern light, searchit, simplesearch, Websmostlinked, webtop, what-u-seek, aol, yahoo, webcrawler, infoseek, excite, magellan, looksmart, bing, cnet, googlebot"
		name="search engines">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	
<title>GitHub Actions: Unified Build Pipeline for Multi-Repo Application | Anton Sizikov</title>

    <link rel="stylesheet" href="/css/main.css">


      <script src="/js/main.js"></script>


</head>
<body>
  <header>
    <div class="international__typo__header__layout">
    <div class="international__typo__header__layout__left">
        <span class="international__typo__header__layout_subdomain">
            <a class="international__typo__header__home" href="/">blog.</a></span>
    </div>
    <div class="international__typo__header__layout__right">
        <span class="international__typo__header__layout__right__domain">cloud-eng</span>
        <span class="international__typo__header__layout__right__tld">.nl</span>
    <div>                        
</div>



  </header>
  <main>
    <div class="international__typo__main__layout">
      <div class="international__typo__main__layout__left"></div>
      <div class="international__typo__main__layout__right">
        <div class="international__typo__main__layout__right__content">
        
<div class="international__typo__post__content">
  <h1>GitHub Actions: Unified Build Pipeline for Multi-Repo Application</h1>

  
  
  
  <h2>Published on: 
  <time datetime="2024-04-01T00:00:00&#43;00:00">April 1, 2024</time></h2>

  <h2 id="common-misconceptions-about-github-actions">Common Misconceptions about GitHub Actions</h2>
<p>The other day, I was working with a customer who was planning a migration from JetBrains TeamCity to GitHub Actions.
They expressed a concern that GitHub Actions does not work well in multi-repo setup; they were used to having build pipelines separate from the source code distributed across multiple repositories.</p>
<p>What they had in mind was a business application that consisted of multiple services, each in its own repository. They wanted to have a single multi-stage pipeline that will be triggered by changes in any of these components and will build, test, and deploy the entire application.</p>
<p>Something like this:</p>
<p><img src="/images/2024-02-actions/multi-repo-pipeline.png" alt="Multi-Repo Pipeline"></p>
<p>My customer had some misconceptions about GitHub Actions, such as:</p>
<ul>
<li>GitHub Actions can only build the code stored in the same repository.</li>
<li>GitHub Actions cannot trigger builds in other repositories.</li>
</ul>
<p>These misunderstandings led them to believe they couldn&rsquo;t achieve the same &ldquo;single pane of glass&rdquo; experience they had with TeamCity.</p>
<p>In this post, I&rsquo;ll demonstrate a simplified version of such a setup.</p>
<h2 id="demo-organization">Demo Organization</h2>
<p>I&rsquo;ll use <a href="https://github.com/chain-builds">chain-builds</a> organization as an example.</p>
<p><img src="/images/2024-02-actions/chain-builds-organization.png" alt="Chain Builds"></p>
<p>This organization has the following repositories:</p>
<ul>
<li><a href="https://github.com/chain-builds/builds">chain-builds/builds</a>: contains the build pipeline that orchestrates builds and deployments across the organization.</li>
<li><a href="https://github.com/chain-builds/source-code-backend">chain-builds/source-code-backend</a>: This repository contains the backend code, which is a .NET Application.</li>
<li><a href="https://github.com/chain-builds/source-code-frontend">chain-builds/source-code-frontend</a>: This repository contains the frontend code, a Node.js application.</li>
<li><a href="https://github.com/chain-builds/micro-service">chain-builds/micro-service</a>: This repository is for a Python service, complete with tests.</li>
</ul>
<p>For the purposes of this post, the specific functionalities of these applications are not important; they are just templates that I quicky scafolded for this post.
Let&rsquo;s suppose that these services are part of one large busines application, requiring collective build, testing, and deployment processes.</p>
<h2 id="triggers">Triggers</h2>
<p>Since our main build pipeline defined in the <code>chain-builds/builds</code> repository, we need to be able to trigger in from every dependent repository.</p>
<p>This is quite easy to achieve with GitHub Actions, specifically by emmiting the the <a href="https://docs.github.com/en/actions/using-workflows/events-that-trigger-workflows#repository_dispatch"><code>repository_dispatch</code> event</a>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c">#https://github.com/chain-builds/builds/.github/workflows/build.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">repository_dispatch</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">types</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">dependency_updated]</span><span class="w">
</span></span></span></code></pre></div><p>With this configuration my <code>build.yml</code> workflow can be triggered either manually (<code>workflow_dispatch</code>) or via a <code>repository_dispatch</code> event of the <code>dependency_updated</code> type.</p>
<p><code>dependency_updated</code> event type is a custom identifier I&rsquo;ll use to trigger this pipeline.</p>
<p>Now I need to bind source code repositories to the <code>builds</code> repository. I can create <code>on-push.yml</code> workflow in each of them, that will trigger the common build pipeline by sending a <code>repository_dispatch</code> event on every push to <code>main</code> branch.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c">#.github/workflows/on-push.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Trigger Common Build Workflow</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="l">main ]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">trigger</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">echo &#34;Triggering the workflow&#34;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Trigger repository dispatch</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">peter-evans/repository-dispatch@v3</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">token</span><span class="p">:</span><span class="w"> </span><span class="l">${{ secrets.COMMON_BUILD_PIPELINE_PAT }}</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l">chain-builds/builds</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">event-type</span><span class="p">:</span><span class="w"> </span><span class="l">dependency_updated</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">            </span><span class="nt">client-payload</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;{&#34;triggered_by&#34;: &#34;${{ github.repository }}, on push event&#34;, &#34;commit_sha&#34;: &#34;${{ github.sha }}&#34;, &#34;branch&#34;: &#34;${{ github.ref }}&#34;}&#39;</span><span class="w">
</span></span></span></code></pre></div><p>Because I&rsquo;m calling an external workflow, I need to provide a Personal Access Token (PAT) with &ldquo;content read a write access&rdquo; to the <code>builds</code> repository. (I&rsquo;m using fine-grained PAT here).</p>
<p>I can have this PAT on the organization level, so it can be <a href="https://docs.github.com/en/actions/using-workflows/sharing-workflows-secrets-and-runners-with-your-organization#sharing-secrets-and-variables-within-an-organization">shared with repositories that require it</a>.</p>
<p><img src="/images/2024-02-actions/pat-org-settings.png" alt="PAT Organization"></p>
<p>this will submit a <code>repository_dispatch</code> event to the <code>builds</code> repository with the following payload:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-json" data-lang="json"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;triggered_by&#34;</span><span class="p">:</span> <span class="s2">&#34;chain-builds/micro-service, on push event&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;commit_sha&#34;</span><span class="p">:</span> <span class="s2">&#34;f9c8b06ff7385070bdba85ebf9ff5aa6b9e5fa14&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;branch&#34;</span><span class="p">:</span> <span class="s2">&#34;refs/heads/main&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>For demonstration purposes, I&rsquo;ve included a job that prints the payload to the Job Summary.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c">#https://github.com/chain-builds/builds/.github/workflows/build.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">who-triggered-me</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">Who triggered me?</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">          echo &#34;### This pipeline trigger summary 🚀&#34; &gt;&gt; $GITHUB_STEP_SUMMARY
</span></span></span><span class="line"><span class="cl"><span class="sd">          echo &#34;I was triggered by ${{ github.event_name }}&#34; &gt;&gt; $GITHUB_STEP_SUMMARY
</span></span></span><span class="line"><span class="cl"><span class="sd">          if [ &#34;${{ github.event_name }}&#34; == &#34;repository_dispatch&#34; ]; then
</span></span></span><span class="line"><span class="cl"><span class="sd">            echo &#34;Triggered: ${{ github.event.client_payload.triggered_by }}&#34; &gt;&gt; $GITHUB_STEP_SUMMARY
</span></span></span><span class="line"><span class="cl"><span class="sd">            echo &#39;`repository_dispatch` payload:&#39; &gt;&gt; $GITHUB_STEP_SUMMARY
</span></span></span><span class="line"><span class="cl"><span class="sd">            echo &#39;```json&#39; &gt;&gt; $GITHUB_STEP_SUMMARY
</span></span></span><span class="line"><span class="cl"><span class="sd">            echo &#39;${{ toJson(github.event.client_payload) }}&#39; | jq . &gt;&gt; $GITHUB_STEP_SUMMARY
</span></span></span><span class="line"><span class="cl"><span class="sd">            echo &#39;```&#39; &gt;&gt; $GITHUB_STEP_SUMMARY
</span></span></span><span class="line"><span class="cl"><span class="sd">          elif [ &#34;${{ github.event_name }}&#34; == &#34;workflow_dispatch&#34; ]; then
</span></span></span><span class="line"><span class="cl"><span class="sd">            echo &#34;Manual trigger&#34; &gt;&gt; $GITHUB_STEP_SUMMARY
</span></span></span><span class="line"><span class="cl"><span class="sd">          fi</span><span class="w">          
</span></span></span></code></pre></div><p>This will be rendered as following:</p>
<p><img src="/images/2024-02-actions/who-triggered-me.png" alt="Who Triggered Me"></p>
<h2 id="building-code-from-another-repository">Building code from another repository</h2>
<p>Now that we have a way to trigger the build pipeline from the source code repositories, we need to be able to checkout the code from these repositories.</p>
<p>For a simple scenario, where there is no need to store pipelines in the srouce code repo, we can keep the entire build logic in our <code>builds</code> repository.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c">#https://github.com/chain-builds/builds/.github/workflows/build.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c">#...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">build_frontend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-22.04</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">defaults</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l">my-nodejs-app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l">chain-builds/source-code-frontend        </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">npm install</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">npm test</span><span class="w">
</span></span></span></code></pre></div><p>Here, I&rsquo;m just using <code>actions/checkout</code> action to checkout the code from the <code>source-code-frontend</code> repository. This repository is public, so I don&rsquo;t need to provide any credentials.</p>
<h2 id="multiple-jobs-and-artifacts">Multiple jobs and artifacts</h2>
<p>In real-world scenario, we would probably have multiple jobs that build and test different parts of the application.
This is what I&rsquo;m doing to build and test the backend code:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c">#https://github.com/chain-builds/builds/.github/workflows/build.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c">#...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">build_backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">defaults</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l">my-dotnet-app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l">chain-builds/source-code-backend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">dotnet build src/my-dotnet-app.csproj</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">dotnet pack src/my-dotnet-app.csproj --output output</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/upload-artifact@v4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-dotnet-app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">my-dotnet-app/output/*.nupkg </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c"># ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">test_backend</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-22.04</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">defaults</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">working-directory</span><span class="p">:</span><span class="w"> </span><span class="l">my-dotnet-app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="l">build_backend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="l">chain-builds/source-code-backend</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="l">dotnet test tests/my-dotnet-app.tests.csproj</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"> </span><span class="c"># ...</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">   </span><span class="nt">deploy-all</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">needs</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="l">build_frontend, test_backend, build_microservice]</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">environment</span><span class="p">:</span><span class="w"> </span><span class="l">production</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/download-artifact@v4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">my-dotnet-app</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">          </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l">application</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">          pushd application
</span></span></span><span class="line"><span class="cl"><span class="sd">          echo &#34;Deploying application&#34;
</span></span></span><span class="line"><span class="cl"><span class="sd">          ls -la</span><span class="w">          
</span></span></span></code></pre></div><p>This approach is quite straightforward: build and test code in parallel, upload artifacts, and then deploy everything once all jobs are completed.</p>
<h2 id="keeping-workflows-next-to-source-code">Keeping Workflows next to source code</h2>
<p>Let&rsquo;s make it a bit more complicated. In my <code>chain-builds/micro-service</code> repository, I have a <code>build.yml</code> workflow that defines the build pipeline for this repository.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># https://github.com/chain-builds/micro-service/.github/workflows/build.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="c">#.. triggers omitted</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">jobs</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">build</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">runs-on</span><span class="p">:</span><span class="w"> </span><span class="l">ubuntu-latest</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">steps</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/checkout@v4</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">repository</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;chain-builds/micro-service&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">🐍 Set up Python </span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">uses</span><span class="p">:</span><span class="w"> </span><span class="l">actions/setup-python@v5</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">with</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">        </span><span class="nt">python-version</span><span class="p">:</span><span class="w"> </span><span class="s1">&#39;3.10&#39;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">📦 Install dependencies</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">        ls -la
</span></span></span><span class="line"><span class="cl"><span class="sd">        python -m pip install --upgrade pip
</span></span></span><span class="line"><span class="cl"><span class="sd">        pip install -r requirements.txt</span><span class="w">        
</span></span></span><span class="line"><span class="cl"><span class="w">    </span>- <span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l">🔬 Run tests</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span><span class="nt">run</span><span class="p">:</span><span class="w"> </span><span class="p">|</span><span class="sd">
</span></span></span><span class="line"><span class="cl"><span class="sd">        python -m unittest discover tests</span><span class="w">        
</span></span></span></code></pre></div><p>Nothing unusual here except the explicit repository parameter in the <code>actions/checkout</code> step. This is needed because the default value is set to <code>{{ github.repository }}</code> and when the workflow is triggered as reusable one by the <code>builds</code> repository, it would otherwise attempt to checkout the calling repository instead of the intended source code repository.</p>
<p>The workflow could have these triggers:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-yaml" data-lang="yaml"><span class="line"><span class="cl"><span class="c"># https://github.com/chain-builds/micro-service/.github/workflows/build.yml</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="nt">on</span><span class="p">:</span><span class="w"> 
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workflow_call</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">workflow_dispatch</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">  </span><span class="nt">push</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">    </span><span class="nt">branches-ignore</span><span class="p">:</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w">      </span>- <span class="l">main</span><span class="w">
</span></span></span></code></pre></div><p>These settings allow the workflow to be triggered manually, called by another workflow, or by pushing code to any branch other than <code>main</code>.
The push to any feature branch will run this workflow independently of the Common Build Pipeline. This way only the source code of this Python service will be built and tested without the need to run the entire build pipeline.</p>
<h2 id="summary">Summary</h2>
<p>In this post, I demonstate how GitHub Actions can orchestrate complex build pipelines across multiple repositories.
Any change pushed to <code>main</code> branch of any service repository triggers common build pipeline that is stored separately from these service repos.</p>
<p><img src="/images/2024-02-actions/common-build-pipeline.png" alt="Common Build Pipeline"></p>
<p>This provides a single plane of glass overview of the CI/CD process for the multi-repository project.</p>
<h2 id="disclosure">Disclosure</h2>
<blockquote>
<p>I&rsquo;m employed by GitHub at the time of writing this post. All opinions are my own.</p>
</blockquote>

  
  <div>
    <div>Tags:</div>
    <ul>
        <li><a href="/tags/github-actions/">Github-Actions</a></li>
        <li><a href="/tags/multirepo/">Multirepo</a></li>
        <li><a href="/tags/devops/">Devops</a></li>
    </ul>
  </div>

</div>

        </div>
      </div>
    </div>    
  </main>
  <footer>
    <p>Copyright 2024. All rights reserved.</p>

  </footer>
</body>
<script>(function (d, e) { d[e] = d[e].replace("no-js", "js"); })(document.documentElement, "className");</script>
<script>
    
    
    
        (function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); ga('create', 'UA-64347270-1', 'auto'); ga('send', 'pageview');
    

    
    
    
    

    if ('serviceWorker' in navigator) {
        const buildDate = "5/5/24";
        navigator.serviceWorker
            .register("/sw.js", { scope: '/' })
            .then(function (registration) {
                console.log('Service Worker Registered');
            });

        navigator.serviceWorker
            .ready
            .then(function (registration) {
                console.log('Service Worker Ready');
            });
    }
</script>
</html>
