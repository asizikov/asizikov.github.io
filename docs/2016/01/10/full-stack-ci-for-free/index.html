<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<meta content="index,follow" name="googlebot">
	<meta content="follow, all" name="Googlebot-Image">
	<meta content="follow, all" name="Scooter">
	<meta content="follow, all" name="msnbot">
	<meta content="follow, all" name="alexabot">
	<meta content="follow, all" name="Slurp">
	<meta content="follow, all" name="ZyBorg">
	<meta content="follow, all" name="Scooter">
	<meta content="true" name="MSSmartTagsPreventParsing">
	<meta content="ALL" name="SPIDERS">
	<meta content="ALL" name="WEBCRAWLERS">
	<meta
		content="aeiwi, alexa, alltheWeb, altavista, aol netfind, anzwers, canada, directhit, euroseek, excite, overture, go, google, hotbot. infomak, kanoodle, lycos, mastersite, national directory, northern light, searchit, simplesearch, Websmostlinked, webtop, what-u-seek, aol, yahoo, webcrawler, infoseek, excite, magellan, looksmart, bing, cnet, googlebot"
		name="search engines">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	
<title>Fully automated Continuous Integration for your Open Source library for free | Anton Sizikov</title>

    <link rel="stylesheet" href="/css/main.css">


      <script src="/js/main.js"></script>


</head>
<body>
  <header>
    <div class="international__typo__header__layout">
    <div class="international__typo__header__layout__left">
        <span class="international__typo__header__layout_subdomain">
            <a class="international__typo__header__home" href="/">blog.</a></span>
    </div>
    <div class="international__typo__header__layout__right">
        <span class="international__typo__header__layout__right__domain">cloud-eng</span>
        <span class="international__typo__header__layout__right__tld">.nl</span>
    <div>                        
</div>



  </header>
  <main>
    <div class="international__typo__main__layout">
      <div class="international__typo__main__layout__left"></div>
      <div class="international__typo__main__layout__right">
        <div class="international__typo__main__layout__right__content">
        
<div class="international__typo__post__content">
  <h1>Fully automated Continuous Integration for your Open Source library for free</h1>

  
  
  
  <h2>Published on: 
  <time datetime="2016-01-10T00:00:00&#43;00:00">January 10, 2016</time></h2>

  <p><img src="/images/ci-for-free/communism.png" alt="open source is commumism">
This is a long title. Well, the post is going to be long as well.</p>
<p>I want to show how you can set up the CI pipeline using free services and tools.</p>
<ul>
<li><a href="https://github.com">GitHub</a></li>
<li><a href="https://github.com/GitTools/GitVersion">GitVersion</a></li>
<li><a href="https://www.appveyor.com/">AppVeyor</a></li>
</ul>
<p>As an example I&rsquo;m going to use my pet project: <a href="https://github.com/asizikov/AsyncSuffix">AsyncSuffix</a> plugin for ReSharper. The reason is that the way you pack and publish R# extensions is slightly different from the regular NuGet package. I actually faced some limitations of NuGet.exe and AppVeyor.</p>
<h2 id="github">GitHub</h2>
<p>Git and GitHub both are kind of industry standard for open source software development nowadays.</p>
<p>I&rsquo;m using slightly modified version of git flow for my project. I have two mandatory branches <code>master</code> and <code>develop</code>.
<code>Master</code> branch contains released code marked with tags. <code>Develop</code> branch is for stable pre-release code.
These two branches are configured <a href="https://help.github.com/articles/about-protected-branches/">as protected</a>, so code can never be merged unless <a href="https://github.com/blog/2051-protected-branches-and-required-status-checks">CI server reports the successful build</a>. This allows me to publish stable and pre release packages automatically.</p>
<p>The development is taking place in feature branches. The build triggered from the feature branch will create an alpha package and publish it to separate NuGet feed provided by AppVeyor.</p>
<h2 id="gitversion">GitVersion</h2>
<p>I like the approach suggested by GitVersion. You can define package version based on your branching model.</p>
<p>The basic idea is simple:</p>
<ul>
<li>The build triggered by commit to Feature branch produces alpha package, beta packages come from develop branch, release candidates come from master.</li>
<li>The tag produces stable version.</li>
</ul>
<p>If you want to get more backgrounds I recommend you a nice <a href="http://gusztavvargadr.github.io/2015/09/20/1-everyday-gitflow-and-semantic-versioning/">couple</a> of <a href="http://gusztavvargadr.github.io/2015/10/30/2-gitversion-to-the-rescue/">posts</a> written by <a href="https://twitter.com/gusztavvargadr">my colleague</a>.</p>
<h2 id="appveyor">AppVeyor</h2>
<p>I&rsquo;m using AppVeyor as a CI server.</p>
<p>AppVeyor is a free cloud build server which is <a href="http://www.appveyor.com/docs">easy to integrate</a> with your GitHub repository.
Creating the account is simple, you can log in using your GitHub and youâ€™re done.</p>
<p>There are two ways to configure build for the project.</p>
<ul>
<li>Using UI</li>
<li>By placing <a href="https://www.appveyor.com/docs/appveyor-yml">AppVeyor.yml</a> file to the root of the repository.</li>
</ul>
<p>First option is good for testing, but committing configuration file to the repository gives you ability to track versions.</p>
<h2 id="the-goal">The goal</h2>
<p>As I already mentioned, I work in a feature branch and I want to make sure that build is not broken.
That means that build server constantly compiles and packs code.
However code in a feature branch is most likely unstable and it&rsquo;s better not to publish it to the official feed.</p>
<p>On the other hand when the feature is complete, tested, and merged to <code>develop</code> branch I&rsquo;m more than happy to publish prerelease package.
I&rsquo;m dogfooding anyway.</p>
<p>External pull requests are different story. The build process must be triggered (how else can I be sure that it&rsquo;s safe to accept it?). But I don&rsquo;t want to have any packages created.</p>
<p>Let&rsquo;s summarise it:</p>
<ul>
<li>Build process is triggered by any commit, merge or tag action</li>
<li>Build process depends on the branch name</li>
</ul>
<h2 id="configuration">Configuration</h2>
<p>First of all we need to agree on the branch naming. Typically it depends on the branching model you use.
For GitFlow I&rsquo;m using the following naming convention:</p>
<ul>
<li><code>master</code> and <code>develop</code> - for stable code</li>
<li><code>feature/*</code> - for unfinished features</li>
</ul>
<p>My <code>AppVeyor.yml</code> will look like:</p>
<script src="https://gist.github.com/asizikov/0498fdbd14888bea9b17.js"></script>

<p>Unfortunately there is no way to have common sections in the config file (well, at least at the moment),
so we have no other option but having very similar configurations. However AppVeyor evolves very quickly and we can expect some improvements.</p>
<p>Once we have templates defined we can start with actual build steps.</p>
<p>Install GitVersion from <a href="https://chocolatey.org/">Chocolatey</a></p>
<pre tabindex="0"><code>install:
    - choco install gitversion.portable -y
</code></pre><p>Define environment variables (different for each branch configuration)</p>
<pre tabindex="0"><code>environment:
    resharper_nuget_api_key:
      secure: RjiHK3Oxp74LUrI1/vmc2S36zOSRLxFM1Eq0Qn4hixWiou11jFqUbW2ukMNXrazP
</code></pre><p>Important note: the api key is <a href="https://ci.appveyor.com/tools/encrypt">encrypted</a> and can be published to the public repository.</p>
<p>Restore NuGet packages and set the build version.</p>
<pre tabindex="0"><code>before_build:
    - ps: nuget restore
    - ps: gitversion /l console /output buildserver /updateassemblyinfo /b (get-item env:APPVEYOR_REPO_BRANCH).Value
</code></pre><p>The build itself:</p>
<pre tabindex="0"><code>build:
    project: AsyncSuffix.sln
</code></pre><p>Now it&rsquo;s time to create NuGet package.
AppVeyor has a feature to create packages automatically:</p>
<p><img src="/images/ci-for-free/package-projects.png" alt="CreatePackage"></p>
<p>Doesn&rsquo;t work for me though. At the moment it <a href="http://help.appveyor.com/discussions/problems/2698-when-using-publish_nuget-true-my-nuspec-is-ignored-and-it-is-packaging-the-csproj-instead">ignores the content</a> of <code>.nuspec</code> file,
and performs <code>nuget pack</code> command on the <code>csproj</code> file.</p>
<p>That&rsquo;s why I have to define an <code>after_build</code> step:</p>
<pre tabindex="0"><code>after_build:
    - ps: nuget pack AsyncSuffix/AsyncSuffix.nuspec -Version (get-item env:GitVersion_InformationalVersion).Value
</code></pre><p>I have to specify the version, because the <code>nuget pack</code> command reads package version from assembly annotations.
Unfortunately I have this annotation:</p>
<script src="https://gist.github.com/asizikov/4f9eb8f0375e3ce81de0.js"></script>

<p>As you can guess <code>RegisterConfigurableSeverityAnnotation</code> is declared in one of R# SDK&rsquo;s assemblies. NuGet fails to load it and falls back to <code>1.0.0</code> version.</p>
<p>The final step is different for every branch configuration:</p>
<pre tabindex="0"><code>- ps: if(-not $env:APPVEYOR_PULL_REQUEST_NUMBER){ 
        nuget push *.nupkg 
            -ApiKey (get-item env:resharper_nuget_api_key).Value 
            -Source https://resharper-plugins.jetbrains.com 
      }
</code></pre><p>If <code>APPVEYOR_PULL_REQUEST_NUMBER</code> environment variable is defined that means that we&rsquo;re currently performing a synthetic build of merge commit from Pull Request.
The <code>ApiKey</code> will be transparently decrypted and the package will be published:</p>
<p><img src="/images/ci-for-free/pushing-package.png" alt="Success"></p>
<p>P.S. You can definitely do more than publishing packages. You can <a href="https://www.appveyor.com/docs/running-tests">execute tests</a>, custom build scripts (PowerShell, <a href="http://fsharp.github.io/FAKE/">FAKE</a>) or even <a href="https://www.appveyor.com/docs/deployment">deploy</a> your application.</p>

  
  <div>
    <div>Tags:</div>
    <ul>
        <li><a href="/tags/github/">Github</a></li>
        <li><a href="/tags/appveyor/">Appveyor</a></li>
        <li><a href="/tags/devops/">Devops</a></li>
    </ul>
  </div>

</div>

        </div>
      </div>
    </div>    
  </main>
  <footer>
    <p>Copyright 2024. All rights reserved.</p>

  </footer>
</body>
<script>(function (d, e) { d[e] = d[e].replace("no-js", "js"); })(document.documentElement, "className");</script>
<script>
    
    
    
        (function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); ga('create', 'UA-64347270-1', 'auto'); ga('send', 'pageview');
    

    
    
    
    

    if ('serviceWorker' in navigator) {
        const buildDate = "5/5/24";
        navigator.serviceWorker
            .register("/sw.js", { scope: '/' })
            .then(function (registration) {
                console.log('Service Worker Registered');
            });

        navigator.serviceWorker
            .ready
            .then(function (registration) {
                console.log('Service Worker Ready');
            });
    }
</script>
</html>
