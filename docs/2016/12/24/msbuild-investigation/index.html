<!DOCTYPE html>
<html lang="en-us" dir="ltr">
<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<meta content="index,follow" name="googlebot">
	<meta content="follow, all" name="Googlebot-Image">
	<meta content="follow, all" name="Scooter">
	<meta content="follow, all" name="msnbot">
	<meta content="follow, all" name="alexabot">
	<meta content="follow, all" name="Slurp">
	<meta content="follow, all" name="ZyBorg">
	<meta content="follow, all" name="Scooter">
	<meta content="true" name="MSSmartTagsPreventParsing">
	<meta content="ALL" name="SPIDERS">
	<meta content="ALL" name="WEBCRAWLERS">
	<meta
		content="aeiwi, alexa, alltheWeb, altavista, aol netfind, anzwers, canada, directhit, euroseek, excite, overture, go, google, hotbot. infomak, kanoodle, lycos, mastersite, national directory, northern light, searchit, simplesearch, Websmostlinked, webtop, what-u-seek, aol, yahoo, webcrawler, infoseek, excite, magellan, looksmart, bing, cnet, googlebot"
		name="search engines">
	<link rel="preconnect" href="https://fonts.googleapis.com">
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
	
<title>Investigating unexpected MSBuild behavior | Anton Sizikov</title>

    <link rel="stylesheet" href="/css/main.css">


      <script src="/js/main.js"></script>


</head>
<body>
  <header>
    <div class="international__typo__header__layout">
    <div class="international__typo__header__layout__left">
        <span class="international__typo__header__layout_subdomain">
            <a class="international__typo__header__home" href="/">blog.</a></span>
    </div>
    <div class="international__typo__header__layout__right">
        <span class="international__typo__header__layout__right__domain">cloud-eng</span>
        <span class="international__typo__header__layout__right__tld">.nl</span>
    <div>                        
</div>



  </header>
  <main>
    <div class="international__typo__main__layout">
      <div class="international__typo__main__layout__left"></div>
      <div class="international__typo__main__layout__right">
        <div class="international__typo__main__layout__right__content">
        
<div class="international__typo__post__content">
  <h1>Investigating unexpected MSBuild behavior</h1>

  
  
  
  <h2>Published on: 
  <time datetime="2016-12-24T00:00:00&#43;00:00">December 24, 2016</time></h2>

  <p>Recently I took latest changes from git, merged <code>dev</code> to my current branch and decided to run few integration tests. You know, just to be sure.</p>
<p>What do I see? well&hellip; this.</p>
<blockquote>
<p>Could not load file or assembly &lsquo;<code>Microsoft.Data.Edm, Version=5.6.4.0, Culture=neutral, PublicKeyToken=...</code> or one of its dependencies.</p></blockquote>
<p>That doesn&rsquo;t sound right, though it&rsquo;s typically easy to fix.</p>
<p>The first reaction is to consolidate NuGet packages in my Solution. All the installed packages have same version <code>5.7.0</code> though.</p>
<p><img src="/images/2016-12-msbuild-investigation/installed-package-version.png" alt="Package.config sample"></p>
<p>Well, that happens when a merge conflict was poorly resolved. Perhaps one of the project files has a reference to an old version.</p>
<p>Full-text search shows that each <code>.csproj</code> file has correct path in the <code>&lt;Reference&gt;</code> tag.</p>
<p>Curiouser and curiouser!</p>
<p>dotPeek confirmed that the <code>Microsoft.Data.Edm.dll</code> version in the <code>\bin</code> folder is indeed incorrect. That&rsquo;s odd because I don&rsquo;t have an old version anywhere close to my solution. So where does it come from?</p>
<p>Reading raw MSBuild logs is some kind of an art, so this is where <a href="https://github.com/KirillOsenkov/MSBuildStructuredLog">MSBuildStructuredLog</a> comes to the rescue.</p>
<p>Make sure to add it to your toolbelt! This is a very handy tool for MSBuild logs analysis.</p>
<p>Let&rsquo;s run a verbose build and look at the log. The log is very detailed, however, I think that DoubleWrites section a good starting point.</p>
<p>And here we go: <code>Microsoft.Data.Edm</code> is initially taken from local <code>packages</code> folder and after that suddenly overwritten by the wrong version from my <code>.NETFramework</code> folder.</p>
<p><img src="/images/2016-12-msbuild-investigation/msbuild-log-double-writes.png" alt="MSBuild log"></p>
<p>Still not clear why.</p>
<p>Luckily we can search through the logs. We&rsquo;re interested in resolve messages here:</p>
<p><code>Resolved file path is &quot;C:\Program Files (x86)\Microsoft WCF Data Services\</code></p>
<p><img src="/images/2016-12-msbuild-investigation/msbuild-log-dll-resolved-overview.png" alt="Search"></p>
<p>This is our &ldquo;Ahaaa&rdquo; moment! As you can see on a screenshot above while building project 1 (see the red number, eh?) ResolveAssemblyReferences target picks up a wrong version of that DLL which is required by project 2.</p>
<p>Project 1 has a reference to project 2, and indeed has no references to <code>Microsoft.Data.Edm</code> dll.</p>
<p><img src="/images/2016-12-msbuild-investigation/project-references.png" alt="VS Project References"></p>
<p>And now it&rsquo;s somewhat clear what&rsquo;s going on. On the screenshot below we can see a part of the build log, where unimportant log entries were omitted. First occurrences of project 1 and project 2 are marked on the screenshot.</p>
<p><img src="/images/2016-12-msbuild-investigation/msbuild-log-build-order.png" alt="MSbuild log. Overview"></p>
<p>It seems that MSBuild failed to resolve a path to <code>Microsoft.Data.Edm</code> while preparing project 2, and that&rsquo;s why an old version was used for project 1. However, project 2 has all the references configured correctly.
Once the incorrect DLL version was resolved it&rsquo;s being used for all remain projects.</p>
<p>I&rsquo;m not sure if that&rsquo;s an expected behavior. To be honest I&rsquo;m a bit confused here. At least as a temporary solution I can add <code>Edm</code> package to project 1. That will fix my problem for now.</p>

  
  <div>
    <div>Tags:</div>
    <ul>
        <li><a href="/tags/tools/">Tools</a></li>
    </ul>
  </div>

</div>

        </div>
      </div>
    </div>    
  </main>
  <footer>
    <p>Copyright 2025. All rights reserved.</p>

  </footer>
</body>
<script>(function (d, e) { d[e] = d[e].replace("no-js", "js"); })(document.documentElement, "className");</script>
<script>
    
    
    
        (function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga'); ga('create', 'UA-64347270-1', 'auto'); ga('send', 'pageview');
    

    
    
    
    

    if ('serviceWorker' in navigator) {
        const buildDate = "8/12/25";
        navigator.serviceWorker
            .register("/sw.js", { scope: '/' })
            .then(function (registration) {
                console.log('Service Worker Registered');
            });

        navigator.serviceWorker
            .ready
            .then(function (registration) {
                console.log('Service Worker Ready');
            });
    }
</script>
</html>
